<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard | Your Health Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.css" rel="stylesheet" type="text/css" />
    <script type="module" src="/src/main.js"></script>
  </head>
  <body>
    <!-- Navbar -->
    <div class="navbar bg-base-100 shadow-lg px-2 sm:px-4">
      <div class="navbar-start">
        <div class="dropdown">
          <div tabindex="0" role="button" class="btn btn-ghost lg:hidden">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h8m-8 6h16" />
            </svg>
          </div>
          <ul
            tabindex="0"
            class="menu menu-sm dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow">
            <li><a href="services.html" data-i18n="nav.services">Services</a></li>
            <li><a href="about.html" data-i18n="nav.about">About</a></li>
          </ul>
        </div>
        <a href="index.html" class="btn btn-ghost text-lg sm:text-xl">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 sm:w-8 sm:h-8 text-primary">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
          </svg>
          <span class="hidden sm:inline" data-i18n="nav.brand">Your Health Guide</span>
        </a>
      </div>
      <div class="navbar-center hidden lg:flex">
        <ul class="menu menu-horizontal px-1">
          <li><a href="services.html" class="btn btn-ghost" data-i18n="nav.services">Services</a></li>
          <li><a href="about.html" class="btn btn-ghost" data-i18n="nav.about">About</a></li>
        </ul>
      </div>
      <div class="navbar-end">
        <!-- Language toggle -->
        <button id="language-toggle" class="btn btn-ghost btn-circle mr-2">
          Ø¹Ø±Ø¨ÙŠ
        </button>
        
        <!-- Theme toggle -->
        <label class="swap swap-rotate mr-4">
          <input type="checkbox" class="theme-controller" value="synthwave" />
          <svg
            class="swap-off h-6 w-6 fill-current"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <path
              d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z" />
          </svg>
          <svg
            class="swap-on h-6 w-6 fill-current"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <path
              d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z" />
          </svg>
        </label>

        <!-- Voice and Emergency buttons -->
        <button id="voice-btn" class="btn btn-ghost btn-circle mr-2" title="Voice Commands">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.59-.79-1.59-1.78V9.99c0-.97.71-1.77 1.59-1.77h2.24Z" />
          </svg>
        </button>
        
        <button id="emergency-btn" class="btn btn-error btn-circle mr-2 animate-pulse shadow-lg border-2 border-error" title="Emergency Alert">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
          </svg>
        </button>

        <!-- User dropdown -->
        <div class="dropdown dropdown-end">
          <label tabindex="0" class="btn btn-ghost btn-circle avatar">
            <div class="w-10 rounded-full bg-primary text-white flex items-center justify-center">
              <span id="user-initial">U</span>
            </div>
          </label>
          <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
            <li><a href="/profile.html" data-i18n="nav.profile">Profile</a></li>
            <li><a href="#" onclick="logout()" data-i18n="nav.logout">Logout</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="flex h-screen bg-base-200">

      <!-- Enhanced Sidebar -->
      <aside class="w-64 bg-base-100 shadow-lg border-r border-base-300">
        <div class="p-6">
          <!-- User Profile Section -->
          <div class="flex flex-col items-center mb-6">
            <div class="avatar placeholder mb-3">
              <div class="bg-primary text-primary-content rounded-full w-16">
                <span class="text-xl font-bold" id="user-initial-sidebar">U</span>
              </div>
            </div>
            <h4 class="font-semibold text-base-content" id="user-name">John Doe</h4>
            <p class="text-sm text-base-content/60" id="user-email">john@example.com</p>
          </div>

          <!-- Navigation Menu -->
          <nav class="space-y-2">
            <a href="#" class="flex items-center px-4 py-3 text-primary bg-primary/10 rounded-lg font-medium" onclick="showDashboard()">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5v6m8-6v6m-8 4h8" />
              </svg>
              <span data-i18n="sidebar.dashboard">Dashboard</span>
            </a>

            <a href="prescriptions.html" class="flex items-center px-4 py-3 text-base-content/70 hover:text-primary hover:bg-primary/5 rounded-lg transition-colors">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15.75a9.065 9.065 0 0 1-6.23-.957L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.611L5 14.5" />
              </svg>
              <span data-i18n="sidebar.prescriptions">Prescriptions</span>
            </a>

            <a href="vitals.html" class="flex items-center px-4 py-3 text-base-content/70 hover:text-secondary hover:bg-secondary/5 rounded-lg transition-colors">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
              </svg>
              <span data-i18n="sidebar.vitals">Vitals Tracking</span>
            </a>

            <a href="reports.html" class="flex items-center px-4 py-3 text-base-content/70 hover:text-accent hover:bg-accent/5 rounded-lg transition-colors">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
              </svg>
              <span data-i18n="sidebar.reports">Health Reports</span>
            </a>

            <a href="emergency.html" class="flex items-center px-4 py-3 text-error hover:text-error hover:bg-error/10 rounded-lg transition-colors border-2 border-transparent hover:border-error/20 animate-pulse shadow-lg">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z" />
              </svg>
              <span data-i18n="sidebar.emergency">Emergency</span>
            </a>

            <div class="divider my-4"></div>

            <a href="#" class="flex items-center px-4 py-3 text-base-content/70 hover:text-base-content hover:bg-base-200 rounded-lg transition-colors" onclick="showSettings()">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.3246 4.31731C10.751 2.5609 13.249 2.5609 13.6754 4.31731C13.9508 5.45193 15.2507 5.99038 16.2478 5.38285C17.7913 4.44239 19.5576 6.2087 18.6172 7.75218C18.0096 8.74925 18.5481 10.0492 19.6827 10.3246C21.4391 10.751 21.4391 13.249 19.6827 13.6754C18.5481 13.9508 18.0096 15.2507 18.6172 16.2478C19.5576 17.7913 17.7913 19.5576 16.2478 18.6172C15.2507 18.0096 13.9508 18.5481 13.6754 19.6827C13.249 21.4391 10.751 21.4391 10.3246 19.6827C10.0492 18.5481 8.74926 18.0096 7.75219 18.6172C6.2087 19.5576 4.44239 17.7913 5.38285 16.2478C5.99038 15.2507 5.45193 13.9508 4.31731 13.6754C2.5609 13.249 2.5609 10.751 4.31731 10.3246C5.45193 10.0492 5.99037 8.74926 5.38285 7.75218C4.44239 6.2087 6.2087 4.44239 7.75219 5.38285C8.74926 5.99037 10.0492 5.45193 10.3246 4.31731Z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12C15 13.6569 13.6569 15 12 15C10.3431 15 9 13.6569 9 12C9 10.3431 10.3431 9 12 9C13.6569 9 15 10.3431 15 12Z" />
              </svg>
              <span data-i18n="sidebar.settings">Settings</span>
            </a>
          </nav>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="flex-1 overflow-y-auto p-6">
      <!-- Welcome Section -->
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-base-content mb-2" data-i18n="dashboard.welcome">Welcome to Your Health Dashboard</h2>
        <p class="text-base-content/70" data-i18n="dashboard.subtitle">Manage your health with AI-powered tools and smart tracking</p>
      </div>

      <!-- Dashboard Cards -->
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-lg font-semibold mb-2" data-i18n="dashboard.prescriptions">Prescriptions</h3>
                <p class="text-3xl font-bold text-primary" id="prescription-count">0</p>
                <p class="text-sm text-base-content/60" data-i18n="dashboard.prescriptions.desc">Total scanned</p>
              </div>
              <div class="text-4xl">ðŸ“±</div>
            </div>
          </div>
        </div>
        
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-lg font-semibold mb-2" data-i18n="dashboard.vitals">Vitals Logged</h3>
                <p class="text-3xl font-bold text-secondary" id="vitals-count">0</p>
                <p class="text-sm text-base-content/60" data-i18n="dashboard.vitals.desc">This month</p>
              </div>
              <div class="text-4xl">ðŸ“Š</div>
            </div>
          </div>
        </div>
        
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-lg font-semibold mb-2" data-i18n="dashboard.reports">Reports</h3>
                <p class="text-3xl font-bold text-accent" id="reports-count">0</p>
                <p class="text-sm text-base-content/60" data-i18n="dashboard.reports.desc">Generated</p>
              </div>
              <div class="text-4xl">ðŸ“„</div>
            </div>
          </div>
        </div>
        
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-lg font-semibold mb-2" data-i18n="dashboard.checkup">Next Checkup</h3>
                <p class="text-lg font-bold text-info" data-i18n="dashboard.checkup.date">Jan 15</p>
                <p class="text-sm text-base-content/60" data-i18n="dashboard.checkup.doctor">Dr. Ahmed</p>
              </div>
              <div class="text-4xl">ðŸ©º</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="mb-8">
        <h3 class="text-2xl font-bold mb-4" data-i18n="actions.title">Quick Actions</h3>
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
          <button onclick="window.location.href='prescriptions.html'" class="btn btn-primary btn-lg w-full">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15.75a9.065 9.065 0 0 1-6.23-.957L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.611L5 14.5" />
            </svg>
            <span data-i18n="actions.scan">Scan Prescription</span>
          </button>
          
          <button onclick="window.location.href='vitals.html'" class="btn btn-secondary btn-lg w-full">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
            </svg>
            <span data-i18n="actions.vitals">Log Vitals</span>
          </button>
          
          <button onclick="window.location.href='reports.html'" class="btn btn-accent btn-lg w-full">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
            </svg>
            <span data-i18n="actions.report">Generate Report</span>
          </button>
          
          <button onclick="window.location.href='emergency.html'" class="btn btn-error btn-lg w-full animate-pulse shadow-lg border-2 border-error">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z" />
            </svg>
            <span data-i18n="actions.emergency">Emergency</span>
          </button>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="card bg-base-100 shadow-lg">
        <div class="card-body">
          <h3 class="text-xl font-semibold mb-4" data-i18n="activity.title">Recent Activity</h3>
          <div id="recent-activity" class="space-y-4">
            <div class="flex items-center justify-center py-8">
              <span class="loading loading-spinner loading-lg text-primary"></span>
            </div>
          </div>
        </div>
      </div>
      </main>
    </div>

    <!-- Modals and Components will be dynamically loaded -->
    <div id="modal-container"></div>

    <!-- Offline Indicator -->
    <div id="offline-indicator" class="offline-indicator hidden" data-i18n="msg.offline.limited">
      You're currently offline. Some features may be limited.
    </div>

    <!-- Dashboard-specific JavaScript -->
    <script>
      // Dashboard data loading
      window.loadDashboardData = async function() {
        try {
          // Load dashboard statistics
          const [prescriptions, vitals, reports] = await Promise.all([
            window.offline.getCombinedPrescriptions(),
            window.offline.getCombinedVitals(),
            window.api.getReports().catch(() => ({ results: [] }))
          ]);

          // Update dashboard stats
          window.ui.updateDashboardStats({
            prescriptions: prescriptions.length,
            vitals: vitals.length,
            reports: reports.results?.length || 0
          });

          // Load recent activity
          loadRecentActivity(prescriptions, vitals);

        } catch (error) {
          console.error('Failed to load dashboard data:', error);
          if (window.ui) window.ui.showToast('Failed to load dashboard data', 'error');
        }
      }

      function loadRecentActivity(prescriptions, vitals) {
        const activities = [];

        // Add recent prescriptions
        prescriptions.slice(0, 3).forEach(prescription => {
          activities.push({
            icon: 'ðŸ“±',
            title: 'Prescription Scanned',
            description: `Dr. ${prescription.doctor_name}`,
            timestamp: formatDate(prescription.created_at)
          });
        });

        // Add recent vitals
        vitals.slice(0, 3).forEach(vital => {
          activities.push({
            icon: 'ðŸ“Š',
            title: 'Vital Signs Logged',
            description: `${vital.vital_type}: ${vital.value} ${vital.unit}`,
            timestamp: formatDate(vital.recorded_at)
          });
        });

        // Sort by timestamp and take most recent
        activities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        if (window.ui) {
          window.ui.renderRecentActivity(activities.slice(0, 5));
        }
      }

      function formatDate(dateString) {
        if (!dateString) return 'Recently';
        
        const date = new Date(dateString);
        const now = new Date();
        const diffTime = Math.abs(now - date);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays === 1) return 'Yesterday';
        if (diffDays < 7) return `${diffDays} days ago`;
        return date.toLocaleDateString();
      }

      // Load dashboard data when page loads
      document.addEventListener('DOMContentLoaded', () => {
        // Check if user is authenticated
        if (!window.auth || !window.auth.isAuthenticated()) {
          window.location.href = '/login.html';
          return;
        }
        
        // Add emergency button click handler
        const emergencyBtn = document.getElementById('emergency-btn');
        if (emergencyBtn) {
          emergencyBtn.addEventListener('click', () => {
            window.location.href = 'emergency.html';
          });
        }
        
        // Load dashboard data
        setTimeout(() => {
          window.loadDashboardData();
        }, 1000); // Wait for modules to load
      });
    </script>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>